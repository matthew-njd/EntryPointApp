<div class="flex flex-col min-h-screen">
  <app-nav></app-nav>

  <div class="grow mt-16 sm:mt-40 max-w-4xl mx-auto px-4 w-full">
    @if (service.isLoading()) {
      <div class="flex justify-center items-center py-20">
        <span class="loading loading-spinner loading-xl"></span>
      </div>
    } @else if (service.error()) {
      <div class="alert alert-error mb-4">
        <span>{{ service.error() }}</span>
      </div>
    } @else {
      <button class="btn btn-primary btn-sm" (click)="goBack()">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="20"
          height="20"
          viewBox="0 0 24 24"
        >
          <path
            fill="currentColor"
            d="m7.825 13l4.9 4.9q.3.3.288.7t-.313.7q-.3.275-.7.288t-.7-.288l-6.6-6.6q-.15-.15-.213-.325T4.426 12t.063-.375t.212-.325l6.6-6.6q.275-.275.688-.275t.712.275q.3.3.3.713t-.3.712L7.825 11H19q.425 0 .713.288T20 12t-.288.713T19 13z"
          />
        </svg>
        Back to Dashboard
      </button>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 mt-6">
        <app-card title="Total Hours" value="{{ totalHours() }} hrs"></app-card>
        <app-card
          title="Total Mileage"
          value="{{ totalMileage() }} mi"
        ></app-card>
        <app-card
          title="Total Charges"
          value="${{ totalCharges() }}"
        ></app-card>
      </div>

      @if (weeklyLog() && weeklyLog()!.status === "Draft") {
        <button class="btn btn-primary btn-sm" (click)="editTimesheet()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
          >
            <path
              fill="currentColor"
              d="M5 19h1.425L16.2 9.225L14.775 7.8L5 17.575zm-2 2v-4.25L16.2 3.575q.3-.275.663-.425t.762-.15t.775.15t.65.45L20.425 5q.3.275.438.65T21 6.4q0 .4-.137.763t-.438.662L7.25 21zM19 6.4L17.6 5zm-3.525 2.125l-.7-.725L16.2 9.225z"
            />
          </svg>
          Edit Dailylogs
        </button>
      }

      <div class="flex flex-col items-center">
        <div
          class="w-full overflow-x-auto overflow-y-auto mb-4 mt-4 rounded-box bg-base-300"
        >
          <table class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Hours</th>
                <th>Mileage</th>
                <th>Toll Charges</th>
                <th>Parking Fees</th>
                <th>Other Charges</th>
                <th>Comments</th>
              </tr>
            </thead>
            <tbody>
              @for (dailyLog of service.dailyLogs(); track dailyLog.id) {
                <tr>
                  <td>{{ dailyLog.date | date: "EEE, MMM d, y" }}</td>
                  <td>{{ dailyLog.hours }} hrs</td>
                  <td>{{ dailyLog.mileage }} mi</td>
                  <td>${{ dailyLog.tollCharge }}</td>
                  <td>${{ dailyLog.parkingFee }}</td>
                  <td>${{ dailyLog.otherCharges }}</td>
                  <td>{{ dailyLog.comment || "-" }}</td>
                </tr>
              } @empty {
                <tr>
                  <td colspan="7" class="text-center py-8">
                    No dailylogs found for this week
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      </div>
    }
  </div>

  <app-footer class="mt-8"></app-footer>
</div>
