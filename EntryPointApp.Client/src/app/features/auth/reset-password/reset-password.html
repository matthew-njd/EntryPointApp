<div class="mt-36">
  <h2 class="text-3xl text-center mb-4">EntryPoint, a Timesheet App</h2>
  <fieldset
    class="fieldset bg-base-200 border-base-300 rounded-box w-md mx-auto border p-4"
  >
    <legend class="fieldset-legend">Create New Password</legend>

    <form [formGroup]="resetPasswordForm" (ngSubmit)="onSubmit()">
      @if (successMessage) {
      <div class="alert alert-success mb-4">
        <div>
          <span>{{ successMessage }}</span>
          <p class="text-sm mt-1">Redirecting to login...</p>
        </div>
      </div>
      } @if (errorMessage) {
      <div class="alert alert-error mb-4">
        <span>{{ errorMessage }}</span>
      </div>
      }

      <label class="label">New Password*</label>
      <input
        type="password"
        class="input w-full"
        placeholder="New Password"
        formControlName="newPassword"
        [class.input-error]="newPassword?.invalid && newPassword?.touched"
      />
      <div class="text-base-content/60 text-xs mt-1">
        Must contain: uppercase, lowercase, number, and special character
      </div>
      @if (newPassword?.invalid && newPassword?.touched) {
      <div class="text-error text-sm mt-1">
        @if (newPassword?.errors?.['required']) {
        <span>Password is required</span>
        } @if (newPassword?.errors?.['minlength']) {
        <span>Password must be at least 8 characters</span>
        } @if (newPassword?.errors?.['passwordStrength']) {
        <span
          >Password must contain uppercase, lowercase, number, and special
          character</span
        >
        }
      </div>
      }

      <label class="label mt-4">Confirm Password*</label>
      <input
        type="password"
        class="input w-full"
        placeholder="Confirm Password"
        formControlName="confirmPassword"
        [class.input-error]="
          (confirmPassword?.invalid && confirmPassword?.touched) ||
          (resetPasswordForm.errors?.['passwordMismatch'] && confirmPassword?.touched)
        "
      />
      @if (confirmPassword?.touched) {
      <div class="text-error text-sm mt-1">
        @if (confirmPassword?.errors?.['required']) {
        <span>Please confirm your password</span>
        } @if (resetPasswordForm.errors?.['passwordMismatch'] &&
        !confirmPassword?.errors?.['required']) {
        <span>Passwords do not match</span>
        }
      </div>
      }

      <button
        type="submit"
        class="btn btn-neutral mt-4 w-full"
        [disabled]="isSubmitting || !email || !token"
      >
        @if (isSubmitting) {
        <span class="loading loading-spinner loading-md"></span>
        Resetting... } @else { Reset Password }
      </button>
    </form>
  </fieldset>
</div>
